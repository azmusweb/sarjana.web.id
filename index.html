<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Memuat...</title>
  <style>
    body { margin:0; font-family:sans-serif; background:#f9f9f9; color:#222; }
    header, nav { padding: 1rem; text-align: center; }
    header { background-color: #14532d; color: white; }
    nav { background-color: #166534; }
    nav a { color: white; margin: 0 1rem; text-decoration: none; font-weight: bold; }
    main { padding: 1rem; max-width: 800px; margin: auto; }
    article { background: white; margin-bottom: 2rem; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    img { width: 100%; border-radius: 6px; margin-top: 1rem; }
    .meta { font-size: 0.85rem; color: #666; margin: 0.5rem 0; }
    footer { text-align: center; padding: 2rem; font-size: 0.9rem; color: #777; }
  </style>
</head>
<body>

<header id="site-header">
  <h1 id="site-title">Memuat...</h1>
</header>
<nav id="nav-menu">Memuat menu...</nav>
<main id="content">Sedang memuat konten...</main>
<footer>&copy; 2025 Sarjana</footer>

<script>
const sheetID = "1oMHeKOF2_D6deuV8T1l10_GB0wgsPGLV7WrPcJ6Qxww";
const apiKey = "AIzaSyCaI7qUmiyzqkZG6KLDifcfMGQ_jqcWyxs";

// Mendapatkan slug dari URL
let path = window.location.pathname;
let slug = path === "/" ? null : path.split("/").filter(Boolean).pop();

// Ambil data CONFIG
fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/Config?key=${apiKey}`)
  .then(res => res.json())
  .then(data => {
    const rows = data.values || [];
    rows.forEach(row => {
      const fungsi = (row[0] || "").toLowerCase();
      const nilai = row[1] || "";
      if (fungsi === "logo") {
        document.getElementById("site-title").innerHTML = `<img src="${nilai}" alt="logo" style="height:40px;">`;
      }
      if (fungsi === "warna") {
        document.querySelector("header").style.background = nilai;
        document.querySelector("nav").style.background = nilai;
      }
      if (fungsi === "menu") {
        const menuItems = nilai.split(",").map(item => item.trim());
        document.getElementById("nav-menu").innerHTML =
          menuItems.map(name => `<a href="#">${name}</a>`).join("");
      }
    });
  })
  .catch(err => {
    document.getElementById("nav-menu").innerHTML = "Gagal memuat menu.";
  });

// Ambil data berita
fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/Live Website?key=${apiKey}`)
  .then(res => res.json())
  .then(data => {
    const rows = data.values || [];
    const headers = rows[0];
    const list = rows.slice(1);
    const content = document.getElementById("content");

    if (!list.length) {
      content.innerHTML = "<p>Belum ada berita tersedia.</p>";
      return;
    }

    if (slug) {
      const artikel = list.find(r => r[4] === slug);
      if (!artikel) {
        content.innerHTML = "<p>Berita tidak ditemukan.</p>";
        return;
      }
      document.title = artikel[0];
      content.innerHTML = `
        <article>
          <h2>${artikel[0]}</h2>
          <div class="meta">${artikel[7] || ""} | ${artikel[1] || ""}</div>
          <img src="${artikel[2]}" alt="${artikel[0]}" />
          <p>${(artikel[3] || "").replace(/\n/g, "<br>")}</p>
        </article>
      `;
    } else {
      content.innerHTML = "";
      list.forEach(row => {
        if (row[6]?.toLowerCase() === "tampilkan") {
          content.innerHTML += `
            <article>
              <a href="/${row[4]}" style="text-decoration:none; color:inherit;">
                <h2>${row[0]}</h2>
                <div class="meta">${row[7]} | ${row[1]}</div>
                <img src="${row[2]}" alt="${row[0]}"/>
                <p>${(row[3] || "").slice(0, 140)}...</p>
              </a>
            </article>
          `;
        }
      });
    }
  })
  .catch(error => {
    document.getElementById("content").innerHTML = "<p>Gagal memuat konten.</p>";
    console.error("Spreadsheet error:", error);
  });
</script>

</body>
</html>
